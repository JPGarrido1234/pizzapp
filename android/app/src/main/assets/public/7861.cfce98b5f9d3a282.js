"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7861],{7861:(Y,C,l)=>{l.r(C),l.d(C,{OrdersPageModule:()=>k});var O=l(177),A=l(4341),g=l(8974),y=l(1007),p=l(467),F=l(2181),E=l(7628),x=l(8254),b=l(7586),M=l(9350),e=l(6276),D=l(4666),T=l(2056),U=l(6915);function w(n,u){if(1&n&&(e.j41(0,"div",13)(1,"small"),e.EFF(2),e.k0s()()),2&n){const c=u.$implicit;e.R7$(2),e.Lme(" ",c.und," x ",c.productName," ")}}function z(n,u){if(1&n){const c=e.RV6();e.j41(0,"ion-item")(1,"ion-grid")(2,"ion-row")(3,"ion-col")(4,"div",6),e.EFF(5),e.k0s()()(),e.j41(6,"ion-row")(7,"ion-col"),e.nrm(8,"div",7),e.k0s()(),e.j41(9,"ion-row")(10,"ion-col",8),e.nrm(11,"div",9),e.j41(12,"div"),e.EFF(13),e.k0s(),e.j41(14,"div"),e.EFF(15),e.nI1(16,"number"),e.k0s(),e.DNE(17,w,3,2,"div",10),e.k0s(),e.j41(18,"ion-col",11)(19,"ion-button",12),e.bIt("click",function(){const d=e.eBV(c).$implicit,o=e.XpG();return e.Njj(o.cloneOrder(d))}),e.EFF(20," REPETIR "),e.k0s()()()()()}if(2&n){const c=u.$implicit;e.R7$(5),e.SpI(" ",c.date," "),e.R7$(8),e.SpI(" PEDIDO #",c.number," "),e.R7$(2),e.SpI(" ",e.i5U(16,4,c.total,"1.2-2")," \u20ac "),e.R7$(2),e.Y8G("ngForOf",c.lines)}}let I=(()=>{var n;class u{constructor(t,r,d,o,i){this.userService=t,this.productService=r,this.alertController=d,this.orderService=o,this.router=i,this.orders=[],this.order=null,this.unds=0,this.total=0,this.categories_storage=[],this.ingredients_storage=[],this.sizes_storage=[],this.myUser={id:"",name:"",login:"",address:"",zip:"",birthDate:"",password:"",phone:"",codeValidated:!1,logged:!1,active:!1,role:"",setLogged:function(s){throw new Error("Function not implemented.")},isLogged:function(){throw new Error("Function not implemented.")},isActive:function(){throw new Error("Function not implemented.")}}}ngOnInit(){var t=this;this.userService.getUser().then(function(){var r=(0,p.A)(function*(d){t.myUser=d,t.userService.getOrders(t.myUser.id).subscribe(o=>{t.orders=Array.isArray(o)?o.map(i=>(i.date=b(i.date).format("DD.MM.YYYY"),i)):[],Array.isArray(o)||console.error("Expected orders to be an array, but got:",o)},function(){var o=(0,p.A)(function*(i){yield(yield t.alertController.create({header:"Error",message:i.message,buttons:["OK"]})).present()});return function(i){return o.apply(this,arguments)}}())});return function(d){return r.apply(this,arguments)}}())}ionViewDidLoad(){}ionViewDidEnter(){var t=this;this.userService.getUser().then(function(){var r=(0,p.A)(function*(d){t.myUser=d,console.log("User: "+t.myUser.id),t.userService.getOrders(t.myUser.id).subscribe(o=>{console.log("Orders: "+JSON.stringify(o)),t.orders=Array.isArray(o)?o.map(i=>(i.date=b(i.date).format("DD.MM.YYYY"),i)):[],Array.isArray(o)||console.error("Expected orders to be an array, but got:",o)},function(){var o=(0,p.A)(function*(i){yield(yield t.alertController.create({header:"Error",message:i.message,buttons:["OK"]})).present()});return function(i){return o.apply(this,arguments)}}())});return function(d){return r.apply(this,arguments)}}())}cloneOrder(t){var r=this;return(0,p.A)(function*(){r.loadCategories(),r.loadIngredients(),r.loadSizes(),r.order=t;try{const d=yield Promise.all(r.order.lines.map(function(){var s=(0,p.A)(function*(a){console.log("Fetching product with ID:",a.productId);try{if(!a.productId)throw new Error(`Invalid product ID: ${a.productId}`);return function S(n,u){const c="object"==typeof u;return new Promise((t,r)=>{let o,d=!1;n.subscribe({next:i=>{o=i,d=!0},error:r,complete:()=>{d?t(o):c?t(u.defaultValue):r(new M.G)}})})}(r.productService.findById(a.productId))}catch(h){return console.error("Error fetching product:",h),null}});return function(a){return s.apply(this,arguments)}}())),o=d.map(s=>{const a=new F.Y(s,r.productService,r.ingredients_storage),h=r.categories_storage.find(m=>m.id==s.category);if(void 0!==h&&h.name.toLowerCase().includes("pizzas")){let m=a.sizes.filter(f=>"IND"==f.code)[0];void 0!==m.price&&(a.price=m.price)}return a}),i=[];r.order.lines.map(s=>{const a=o.find(v=>v.id==s.productId);if(!a||!a.active||!a.available)return a&&i.push(`${a.name} no est\xe1 disponible`),null;const h=s.ingredientsToAdd.every(v=>{const P=a.allIngredients.find(N=>N.id==v);return!!(P&&P.active&&P.available)||(i.push(`${a.name} no se puede aplicar la misma configuraci\xf3n de ingredientes extra a a\xf1adir`),!1)}),m=r.categories_storage.find(v=>v.id==a.category);if(!m)return i.push(`Category not found for product ${a.name}`),null;const f=new E.$(t,a,m,r.ingredients_storage,r.sizes_storage);return m.name.toLowerCase().includes("pizzas")&&(h&&(f.ingredientsToAdd=s.ingredientsToAdd,f.ingredientsToAddText=s.ingredientsToAddText),f.ingredientsToRemove=s.ingredientsToRemove,f.ingredientsToRemoveText=s.ingredientsToRemoveText,f.notes=s.notes,f.isHalfAndHalf=s.isHalfAndHalf,f.half=s.half,f.und=s.und,f.priceUnd=s.priceUnd,f.priceTotal=s.priceTotal),r.orderService.setOrder(t),f}),i.length>0&&(yield(yield r.alertController.create({header:"ATENCI\xd3N",message:i.join("<br>"),buttons:["OK"]})).present()),console.log("Products from server: "+JSON.stringify(d))}catch(d){console.error("Error fetching products from server:",d)}r.order.lines=r.order.lines.filter(d=>null!=d),r.router.navigate(["/cart"])})()}loadCategories(){var t=this;return(0,p.A)(function*(){const{value:r}=yield x.p.get({key:"categories"});r&&(t.categories_storage=JSON.parse(r))})()}loadIngredients(){var t=this;return(0,p.A)(function*(){const{value:r}=yield x.p.get({key:"ingredients"});r&&(t.ingredients_storage=JSON.parse(r))})()}loadSizes(){var t=this;return(0,p.A)(function*(){const{value:r}=yield x.p.get({key:"sizes"});r&&(t.sizes_storage=JSON.parse(r))})()}}return(n=u).\u0275fac=function(t){return new(t||n)(e.rXU(D.D),e.rXU(T.b),e.rXU(g.hG),e.rXU(U.Q),e.rXU(y.Ix))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-orders"]],decls:10,vars:2,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],[1,"ion-text-center"],["padding","",1,"icontent"],[4,"ngFor","ngForOf"],[1,"orderDate"],[2,"height","5px"],["size","7"],[2,"height","10px"],["class","productsDiv",4,"ngFor","ngForOf"],["size","5"],["expand","block",1,"btn_red",3,"click"],[1,"productsDiv"]],template:function(t,r){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title",3),e.EFF(5,"TUS PEDIDOS"),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-content",4)(8,"ion-list"),e.DNE(9,z,21,7,"ion-item",5),e.k0s()()()),2&t&&(e.Y8G("translucent",!0),e.R7$(9),e.Y8G("ngForOf",r.orders))},dependencies:[O.Sq,g.Jm,g.QW,g.hU,g.W9,g.lO,g.eU,g.uz,g.nf,g.MC,g.ln,g.BC,g.ai,O.QX],styles:[".title[_ngcontent-%COMP%]{text-align:center;color:#000}.icontent[_ngcontent-%COMP%]{min-height:100%;background-size:1px 100%;background-repeat:no-repeat}.item-md[_ngcontent-%COMP%]{background:none}.list-md[_ngcontent-%COMP%]   .item-block[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border:none}.orderDate[_ngcontent-%COMP%]{background-color:#e30025;color:#fff;font-weight:700;border-radius:20px;padding:5px 0 5px 20px;width:150px}.orderInfo[_ngcontent-%COMP%]{background-color:#fff;color:#000;font-weight:700;font-size:20px;border:1px solid #e30025;border-radius:20px;padding:5px 0 5px 20px;width:100%}.productsDiv[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}small[_ngcontent-%COMP%]{font-weight:400}"]}),u})();const R=[{path:"orders",component:I}];let $=(()=>{var n;class u{}return(n=u).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[y.iI.forChild(R),y.iI]}),u})();const j=[{path:"",component:I}];let k=(()=>{var n;class u{}return(n=u).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[O.MD,A.YN,g.bv,$,y.iI.forChild(j)]}),u})()}}]);