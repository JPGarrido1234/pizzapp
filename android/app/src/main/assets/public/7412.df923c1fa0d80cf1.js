"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7412],{7412:(P,p,a)=>{a.r(p),a.d(p,{CategoryPageModule:()=>R});var g=a(177),m=a(4341),i=a(8974),n=a(1007),h=a(467),y=a(2181),u=a(7628),C=a(450),_=a(8254),t=a(6276),f=a(2056),I=a(6915);function O(o,d){if(1&o){const s=t.RV6();t.j41(0,"div",13),t.bIt("click",function(){t.eBV(s);const r=t.XpG();return t.Njj(r.goCart())}),t.j41(1,"div"),t.EFF(2),t.k0s()()}if(2&o){const s=t.XpG();t.R7$(2),t.JRh(s.unds)}}function z(o,d){1&o&&t.nrm(0,"ion-spinner",14)}function b(o,d){if(1&o&&(t.j41(0,"ion-row")(1,"ion-col",24)(2,"div",29),t.EFF(3," Ingredientes no disponibles: "),t.j41(4,"strong",30),t.EFF(5),t.k0s()()()()),2&o){const s=t.XpG().$implicit;t.R7$(5),t.JRh(s.ingredientsNotAvailable.join(", "))}}function x(o,d){if(1&o){const s=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(s);const r=t.XpG().$implicit,c=t.XpG();return t.Njj(c.goProductPage(r))}),t.EFF(1,"PERSONALIZAR"),t.k0s()}}function M(o,d){if(1&o){const s=t.RV6();t.j41(0,"ion-card",15)(1,"ion-row")(2,"ion-col",16)(3,"img",17),t.bIt("click",function(){const c=t.eBV(s).$implicit,l=t.XpG();return t.Njj(l.goProductPage(c))}),t.k0s()(),t.j41(4,"ion-col",18)(5,"ion-item",19),t.bIt("click",function(){const c=t.eBV(s).$implicit,l=t.XpG();return t.Njj(l.goProductPage(c))}),t.j41(6,"ion-label",20)(7,"h2"),t.EFF(8),t.k0s(),t.j41(9,"p",21),t.EFF(10),t.k0s(),t.j41(11,"div",22),t.EFF(12),t.nI1(13,"number"),t.k0s()()()()(),t.DNE(14,b,6,1,"ion-row",23),t.j41(15,"ion-row")(16,"ion-col",24)(17,"ion-row",25)(18,"ion-col",26)(19,"button",27),t.bIt("click",function(){const c=t.eBV(s).$implicit,l=t.XpG();return t.Njj(l.addLineToOrder(c))}),t.EFF(20,"A\xd1ADIR"),t.k0s()(),t.j41(21,"ion-col",26),t.DNE(22,x,2,0,"button",28),t.k0s()()()()()}if(2&o){const s=d.$implicit,e=t.XpG();t.Y8G("ngClass",s.available?"":"notavailable"),t.R7$(3),t.Y8G("src",s.image,t.B4B)("alt",s.name),t.R7$(5),t.JRh(s.name),t.R7$(2),t.SpI(" ",s.description," "),t.R7$(2),t.SpI(" ",t.i5U(13,8,s.price,"1.2-2")," \u20ac "),t.R7$(2),t.Y8G("ngIf",s.ingredientsNotAvailable.length>0),t.R7$(8),t.Y8G("ngIf",e.isPizzaCategory)}}let v=(()=>{var o;class d{constructor(e,r,c,l){this.route=e,this.router=r,this.productService=c,this.orderService=l,this.error_msg="",this.disable=!1,this.order=new C.p,this.products=[],this.categoryId=null,this.categoryName=null,this.category=null,this.isPizzaCategory=!1,this.unds=null!=this.order?this.order.unds:0,this.categories_storage=[],this.ingredients_storage=[],this.sizes_storage=[],this.isLoading=!0}ngOnInit(){setTimeout(()=>{this.getProducts(),this.isLoading=!1},2e3),this.orderService.getOrder().then(e=>{this.order=e,this.refreshCartUnds()}),this.route.paramMap.subscribe(e=>{this.categoryId=e.get("categoryId"),console.log("Category ID: "+this.categoryId),this.categoryName=e.get("category"),this.loadCategories().then(()=>{this.category=this.categories_storage.find(r=>r.id==this.categoryId),this.category&&(this.isPizzaCategory=this.category.name.toLowerCase().includes("pizzas"))})})}ionViewDidLoad(){setTimeout(()=>{this.getProducts(),this.isLoading=!1},2e3),this.orderService.getOrder().then(e=>{this.order=e,this.refreshCartUnds()}),this.route.paramMap.subscribe(e=>{this.categoryId=e.get("categoryId"),console.log("Category ID: "+this.categoryId),this.categoryName=e.get("category"),this.loadCategories().then(()=>{this.category=this.categories_storage.find(r=>r.id==this.categoryId),this.category&&(this.isPizzaCategory=this.category.name.toLowerCase().includes("pizzas"))})}),this.refreshCartUnds()}ionViewDidEnter(){this.orderService.getOrder().then(e=>{this.order=e,this.refreshCartUnds()}),this.refreshCartUnds()}refreshCartUnds(){this.unds=this.order.unds,console.log("Order:",this.order,"Unds:",this.unds),this.orderService.setOrder(this.order)}getProducts(){this.loadIngredients().then(()=>{console.log("Ingredients loaded"),console.log(this.ingredients_storage),this.categoryId?this.productService.findAll(this.categoryId).then(e=>{console.log(e),e.forEach(r=>{let c=new y.Y(r,this.productService,this.ingredients_storage);if(void 0!==c.sizes){if(this.category.name.toLowerCase().includes("pizzas")){let l=c.sizes.filter(j=>"IND"==j.code)[0];c.price=void 0!==l&&void 0!==l.price?l.price:0}this.products.push(c)}})},e=>{console.error(e)}):console.error("Category ID is null")})}getProductos(){this.productService.getProductsByCategory(this.categoryId).subscribe(e=>{this.products=e})}goProductPage(e){e.available&&this.router.navigate(["/product",e.id])}addLineToOrder(e){e.available&&this.loadSizes().then(()=>{let r=new u.$(this.order,e,this.category,this.ingredients_storage,this.sizes_storage);this.category.name.toLowerCase().includes("pizzas")&&r.setSize("IND"),this.order.addLine(r),this.orderService.setOrder(this.order),this.refreshCartUnds()})}goCart(){this.router.navigate(["/cart"])}loadCategories(){var e=this;return(0,h.A)(function*(){const{value:r}=yield _.p.get({key:"categories"});r&&(e.categories_storage=JSON.parse(r))})()}loadIngredients(){var e=this;return(0,h.A)(function*(){const{value:r}=yield _.p.get({key:"ingredients"});r&&(e.ingredients_storage=JSON.parse(r))})()}loadSizes(){var e=this;return(0,h.A)(function*(){const{value:r}=yield _.p.get({key:"sizes"});r&&(e.sizes_storage=JSON.parse(r))})()}}return(o=d).\u0275fac=function(e){return new(e||o)(t.rXU(n.nX),t.rXU(n.Ix),t.rXU(f.b),t.rXU(I.Q))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-pedido"]],decls:17,vars:6,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],["defaultHref","/menu"],["slot","end"],["class","ico-und",3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","cart-outline",1,"icon-custom"],[1,"ion-text-center",2,"font-size","22px"],[3,"fullscreen"],["size","12",1,"ion-text-center"],["style","width: 100px; height: 100px;","color","danger","name","dots",4,"ngIf"],["class","pizzacard animated bounceInDown",3,"ngClass",4,"ngFor","ngForOf"],[1,"ico-und",3,"click"],["color","danger","name","dots",2,"width","100px","height","100px"],[1,"pizzacard","animated","bounceInDown",3,"ngClass"],["size","4"],[1,"custom-img",3,"src","alt","click"],["size","8"],["lines","none",1,"details",3,"click"],[2,"margin-top","0"],[1,"details-parrafo"],[1,"price"],[4,"ngIf"],["size","12"],[1,"butnsholder",2,"margin-top","0"],["size","6"],["color","light","expand","block",3,"click"],["color","light","expand","block",3,"click",4,"ngIf"],[2,"padding","10px 10px 0 10px"],[2,"color","red"]],template:function(e,r){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t.nrm(3,"ion-back-button",3)(4,"ion-menu-button"),t.k0s(),t.j41(5,"ion-buttons",4),t.DNE(6,O,3,1,"div",5),t.j41(7,"ion-button",6),t.bIt("click",function(){return r.goCart()}),t.nrm(8,"ion-icon",7),t.k0s()(),t.j41(9,"ion-title",8),t.EFF(10),t.k0s()()(),t.j41(11,"ion-content",9)(12,"ion-list")(13,"ion-row")(14,"ion-col",10),t.DNE(15,z,1,0,"ion-spinner",11),t.k0s()(),t.DNE(16,M,23,11,"ion-card",12),t.k0s()()),2&e&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("ngIf",r.unds>0),t.R7$(4),t.JRh(r.categoryName),t.R7$(1),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("ngIf",r.isLoading),t.R7$(1),t.Y8G("ngForOf",r.products))},dependencies:[g.YU,g.Sq,g.bT,i.Jm,i.QW,i.b_,i.hU,i.W9,i.eU,i.iq,i.uz,i.he,i.nf,i.MC,i.ln,i.w2,i.BC,i.ai,i.el,g.QX],styles:[".bar-button-menutoggle-md[_ngcontent-%COMP%]{display:block!important}.ico-und[_ngcontent-%COMP%]{position:fixed;z-index:9;width:30px;height:30px;background-color:#fff;border:2px solid #fff;border-radius:50%;right:25px;top:6px}.ico-und[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:18px;font-weight:700;color:#e30025;margin-top:2px}.details[_ngcontent-%COMP%]{font-size:small}.details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4em}.details-parrafo[_ngcontent-%COMP%]{font-size:1em;font-weight:700;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}ion-card[_ngcontent-%COMP%]{margin-right:0}ion-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#e30025!important}.pizzacard[_ngcontent-%COMP%]{margin-right:10px}ion-item[_ngcontent-%COMP%]{padding-left:0!important;margin-left:-5px}.price[_ngcontent-%COMP%]{color:#e30025;font-size:26px;font-weight:700;font-family:Serif;width:100%}.butnsholder[_ngcontent-%COMP%]{margin-top:20px}.butnsholder[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;border-radius:25px;color:#fff!important;font-size:1em;height:30px;background-color:#e30025;width:100%}.notavailable[_ngcontent-%COMP%]{opacity:.2}ion-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.ion-text-center[_ngcontent-%COMP%]{text-align:center}"]}),d})();const T=[{path:"category",component:v}];let E=(()=>{var o;class d{}return(o=d).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[n.iI.forChild(T),n.iI]}),d})();const k=[{path:"",component:v}];let R=(()=>{var o;class d{}return(o=d).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.MD,m.YN,i.bv,E,n.iI.forChild(k)]}),d})()},450:(P,p,a)=>{a.d(p,{p:()=>g});class g{constructor(){this.name="",this.number="",this.phone="",this.email="",this.pickupTime="",this.orderStatus="WAITING",this.total=0,this.notes="",this.unds=0,this.lines=[],this.userId="",this.date=""}removeLine(i){let n=[];this.lines.forEach(h=>{h.id!=i.id&&n.push(h)}),this.lines=n,this.calculateTotal()}addLine(i){this.lines.push(i),this.calculateTotal()}calculateTotal(){this.unds=0,this.total=0,this.lines.forEach(i=>{this.total+=i.priceTotal,this.unds+=i.und})}isOk(){if(0==this.total||this.lines.length<1)throw"Pedido sin productos";let i=0;if(this.lines.forEach(n=>{n.half&&i++}),i%2>0)throw"Tienes que pedir otra media pizza para completar el pedido";if(""==this.name)throw"Tienes que indicar un nombre de pedido";if(""==this.phone)throw"Tienes que indicarnos tu n\xfamero de tel\xe9fono";if(""==this.email)throw"Tienes que indicarnos tu email";if(""==this.pickupTime)throw"Tienes que especificar la hora de recogida del pedido"}clear(){this.pickupTime="",this.total=0,this.unds=0,this.notes="",this.lines=[]}prepareToPost(){this.lines.forEach(n=>{delete n.order,delete n.image,delete n.ingredients,delete n.product});let i=JSON.parse(JSON.stringify(this));return i.lines.forEach(n=>{delete n.id,delete n.image,delete n.category,delete n.product,delete n.sizes,delete n.ingredients}),i}getPizzasUnd(){let i=0;return this.lines.forEach(n=>{n.pizza&&(i+=n.half?.5:n.und)}),parseInt(i.toString())}}},6915:(P,p,a)=>{a.d(p,{Q:()=>y});var g=a(5312),m=a(2081),i=a(450),n=a(6276),h=a(1626);let y=(()=>{var u;class C{constructor(t){this.http=t,this.order=null}post(t){return this.http.post(g.c.API_URL+"/orders",t,m.A.getHeaders())}gaps(t){return this.http.get(g.c.API_URL+"/gaps/"+t+"?ngsw-bypass=true",m.A.getHeaders())}setOrder(t){this.order=t}getOrder(){return new Promise((t,f)=>{null!==this.order||(this.order=new i.p),t(this.order)})}}return(u=C).\u0275fac=function(t){return new(t||u)(n.KVO(h.Qq))},u.\u0275prov=n.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),C})()}}]);