"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6906],{6906:(J,m,c)=>{c.r(m),c.d(m,{CartPageModule:()=>L});var p=c(177),_=c(4341),a=c(8974),g=c(1007),u=c(467),O=c(7586),h=c(2081),f=c(8254);const P=(0,c(5083).F3)("App",{web:()=>c.e(9303).then(c.bind(c,9303)).then(n=>new n.AppWeb)});var e=c(6276),x=c(6915),b=c(1018),I=c(4666);function M(n,o){if(1&n&&e.nrm(0,"img",34),2&n){const r=e.XpG().$implicit;e.FS9("src",r.product.image,e.B4B),e.FS9("alt",r.productName)}}function k(n,o){1&n&&(e.j41(0,"span"),e.EFF(1,"(1/2 pizza)"),e.k0s())}function G(n,o){if(1&n&&(e.j41(0,"p")(1,"small",35),e.EFF(2),e.k0s(),e.DNE(3,k,2,0,"span",6),e.k0s()),2&n){const r=e.XpG().$implicit;e.R7$(2),e.SpI("Tama\xf1o: ",r.sizeText,""),e.R7$(1),e.Y8G("ngIf",r.half)}}function R(n,o){if(1&n&&(e.j41(0,"p")(1,"small"),e.EFF(2),e.k0s()()),2&n){const r=e.XpG().$implicit;e.R7$(2),e.SpI("Quitar: ",r.ingredientsToRemoveText,"")}}function T(n,o){if(1&n&&(e.j41(0,"p")(1,"small"),e.EFF(2),e.k0s()()),2&n){const r=e.XpG().$implicit;e.R7$(2),e.SpI("A\xf1adir: ",r.ingredientsToAddText,"")}}function F(n,o){if(1&n&&(e.j41(0,"p"),e.EFF(1," Ingredientes no disponibles: "),e.j41(2,"strong",36),e.EFF(3),e.k0s()()),2&n){const r=e.XpG().$implicit;e.R7$(3),e.JRh(r.product.ingredientsNotAvailable.join(", "))}}function j(n,o){if(1&n){const r=e.RV6();e.j41(0,"button",37),e.bIt("click",function(){e.eBV(r);const i=e.XpG().$implicit,s=e.XpG(3);return e.Njj(s.removeUnd(i))}),e.nrm(1,"ion-icon",38),e.k0s()}}function E(n,o){if(1&n&&(e.j41(0,"button",39),e.EFF(1),e.k0s()),2&n){const r=e.XpG().$implicit;e.R7$(1),e.SpI(" ",r.und," ")}}function y(n,o){if(1&n){const r=e.RV6();e.j41(0,"button",37),e.bIt("click",function(){e.eBV(r);const i=e.XpG().$implicit,s=e.XpG(3);return e.Njj(s.addUnd(i))}),e.nrm(1,"ion-icon",40),e.k0s()}}function N(n,o){if(1&n){const r=e.RV6();e.j41(0,"ion-card",13)(1,"ion-row")(2,"ion-col",14)(3,"ion-thumbnail",15),e.bIt("click",function(){const s=e.eBV(r).$implicit,l=e.XpG(3);return e.Njj(l.editLine(s))}),e.DNE(4,M,1,2,"img",16),e.k0s()(),e.j41(5,"ion-col",17)(6,"ion-col",18)(7,"div",19)(8,"span",20),e.EFF(9),e.k0s(),e.DNE(10,G,4,2,"p",6),e.DNE(11,R,3,1,"p",6),e.DNE(12,T,3,1,"p",6),e.DNE(13,F,4,1,"p",6),e.k0s()(),e.j41(14,"ion-col",21)(15,"ion-row",22)(16,"ion-col",23),e.DNE(17,j,2,0,"button",24),e.DNE(18,E,2,1,"button",25),e.DNE(19,y,2,0,"button",26),e.k0s(),e.j41(20,"ion-col",27)(21,"div",28),e.EFF(22),e.nI1(23,"number"),e.k0s()()()(),e.j41(24,"ion-col",29)(25,"ion-row",30),e.bIt("click",function(){const s=e.eBV(r).$implicit,l=e.XpG(3);return e.Njj(l.removeLine(s))}),e.j41(26,"div",31)(27,"div"),e.nrm(28,"img",32),e.k0s(),e.j41(29,"div"),e.nrm(30,"div",33),e.EFF(31," Eliminar "),e.k0s()()()()()()()}if(2&n){const r=o.$implicit;e.R7$(4),e.Y8G("ngIf",null!=r.product),e.R7$(5),e.JRh(r.productName),e.R7$(1),e.Y8G("ngIf",""!=r.sizeText),e.R7$(1),e.Y8G("ngIf",""!=r.ingredientsToRemoveText),e.R7$(1),e.Y8G("ngIf",""!=r.ingredientsToAddText),e.R7$(1),e.Y8G("ngIf",r.product&&r.product.ingredientsNotAvailable.length>0),e.R7$(4),e.Y8G("ngIf",!r.isHalfAndHalf),e.R7$(1),e.Y8G("ngIf",!r.isHalfAndHalf),e.R7$(1),e.Y8G("ngIf",!r.isHalfAndHalf),e.R7$(3),e.SpI("",e.i5U(23,10,r.priceTotal,"1.2-2")," \u20ac")}}function z(n,o){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,N,32,13,"ion-card",12),e.k0s()),2&n){const r=e.XpG(2);e.R7$(1),e.Y8G("ngForOf",r.currentOrder.lines)}}function $(n,o){if(1&n){const r=e.RV6();e.j41(0,"span")(1,"ion-list-header"),e.EFF(2," Escribe los datos del cliente "),e.k0s(),e.j41(3,"ion-item")(4,"ion-input",43),e.bIt("ngModelChange",function(i){e.eBV(r);const s=e.XpG(3);return e.Njj(s.currentOrder.name=i)}),e.k0s()(),e.j41(5,"ion-item")(6,"ion-input",44),e.bIt("ngModelChange",function(i){e.eBV(r);const s=e.XpG(3);return e.Njj(s.currentOrder.phone=i)}),e.k0s()()()}if(2&n){const r=e.XpG(3);e.R7$(4),e.Y8G("ngModel",r.currentOrder.name),e.R7$(2),e.Y8G("ngModel",r.currentOrder.phone)}}function S(n,o){if(1&n&&(e.j41(0,"ion-select-option",48),e.EFF(1),e.k0s()),2&n){const r=o.$implicit;e.FS9("value",r.timestamp),e.Y8G("disabled",!r.available),e.R7$(1),e.JRh(r.text)}}function U(n,o){if(1&n){const r=e.RV6();e.j41(0,"ion-item",45)(1,"ion-select",46),e.bIt("ngModelChange",function(i){e.eBV(r);const s=e.XpG(3);return e.Njj(s.pickupTime=i)}),e.DNE(2,S,2,3,"ion-select-option",47),e.k0s()()}if(2&n){const r=e.XpG(3);e.R7$(1),e.Y8G("ngModel",r.pickupTime),e.R7$(1),e.Y8G("ngForOf",r.gaps)}}function D(n,o){1&n&&(e.j41(0,"div"),e.nrm(1,"br"),e.j41(2,"p",49),e.EFF(3,"En este momento no es posible atender tal cantidad de pizzas. Por favor, llame al 961 78 08 73. Gracias."),e.k0s()())}function A(n,o){if(1&n&&(e.j41(0,"ion-list",41),e.DNE(1,$,7,2,"span",6),e.DNE(2,U,3,2,"ion-item",42),e.DNE(3,D,4,0,"div",6),e.k0s()),2&n){const r=e.XpG(2);e.R7$(1),e.Y8G("ngIf",r.isManager),e.R7$(1),e.Y8G("ngIf",!r.numProductsOverload),e.R7$(1),e.Y8G("ngIf",r.numProductsOverload)}}function w(n,o){if(1&n){const r=e.RV6();e.j41(0,"ion-col",50)(1,"button",51),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.goCheckout())}),e.EFF(2,"Confirmar pedido"),e.k0s()()}if(2&n){const r=e.XpG(2);e.R7$(1),e.Y8G("disabled",!r.orderReady()||r.orderInProccess)}}function X(n,o){if(1&n&&(e.j41(0,"div",7),e.DNE(1,z,2,1,"ion-list",6),e.DNE(2,A,4,3,"ion-list",8),e.j41(3,"ion-row",9),e.DNE(4,w,3,1,"ion-col",10),e.k0s(),e.nrm(5,"div",11),e.EFF(6," \xa0 "),e.k0s()),2&n){const r=e.XpG();e.R7$(1),e.Y8G("ngIf",r.currentOrder.lines.length>0),e.R7$(1),e.Y8G("ngIf",r.currentOrder.total>0),e.R7$(2),e.Y8G("ngIf",null!=r.currentOrder&&r.currentOrder.lines.length>0&&!r.numProductsOverload)}}function Y(n,o){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"number"),e.k0s()),2&n){const r=e.XpG();e.R7$(1),e.SpI(" Total: ",e.i5U(2,1,r.currentOrder.total,"1.2-2")," \u20ac ")}}let v=(()=>{var n;class o{constructor(t,i,s,l,d){this.orderService=t,this.router=i,this.alertController=s,this.userService=l,this.platform=d,this.order=null,this.currentOrder=null,this.numProductsOverload=!1,this.pickupTime="",this.gaps=[],this.orderInProccess=!1,this.isManager=!1,this.user=null,this.previousUrl=null,this.lines=[],this.config_storage={}}ngOnInit(){var t=this;return(0,u.A)(function*(){t.router.events.subscribe(d=>{d instanceof g.wF&&(t.previousUrl=d.url)}),t.platform.ready().then(()=>{P.addListener("backButton",()=>{window.history.back()})});try{if(yield t.userService.isWaitingForCode())return void t.router.navigate(["/code"]);if(!(yield t.userService.isLogged()))return void t.router.navigate(["/register"]);if(t.user=yield t.userService.getUser(),!t.user)throw new Error("User is null");var i,s,l;console.log("User: ",t.user),t.getCurrentOrder(),t.isManager=yield t.userService.isManager(),t.currentOrder?(t.currentOrder.email=null===(i=t.user)||void 0===i?void 0:i.login,t.isManager?(t.currentOrder.name="",t.currentOrder.phone=""):(t.currentOrder.name=null===(s=t.user)||void 0===s?void 0:s.name,t.currentOrder.phone=null===(l=t.user)||void 0===l?void 0:l.phone)):console.error("currentOrder is null"),t.getGaps(),t.intervalId=setInterval(()=>{},1e3)}catch(d){console.error("Error in ngOnInit:",d),t.router.navigate(["/register"])}})()}ionViewDidLoad(){console.log("Order: ",this.order)}ionViewDidEnter(){var t=this;return(0,u.A)(function*(){t.router.events.subscribe(d=>{d instanceof g.wF&&(t.previousUrl=d.url)});try{if(yield t.userService.isWaitingForCode())return void t.router.navigate(["/code"]);if(!(yield t.userService.isLogged()))return void t.router.navigate(["/register"]);if(t.user=yield t.userService.getUser(),!t.user)throw new Error("User is null");var i,s,l;console.log("User: ",t.user),t.getCurrentOrder(),t.isManager=yield t.userService.isManager(),t.currentOrder?(t.currentOrder.email=null===(i=t.user)||void 0===i?void 0:i.login,t.isManager?(t.currentOrder.name="",t.currentOrder.phone=""):(t.currentOrder.name=null===(s=t.user)||void 0===s?void 0:s.name,t.currentOrder.phone=null===(l=t.user)||void 0===l?void 0:l.phone)):console.error("currentOrder is null"),t.getGaps(),t.intervalId=setInterval(()=>{},1e3)}catch(d){console.error("Error in ngOnInit:",d),t.router.navigate(["/register"])}})()}ionViewDidLeave(){clearInterval(this.intervalId)}getCurrentOrder(){this.orderService.getOrder().then(t=>{this.order=t,null!=this.user&&(this.order.userId=this.user.id),this.currentOrder=this.order,console.log("CURRENT ORDER: ",this.currentOrder)})}getGaps(){this.numProductsOverload=!1,this.loadConfig().then(()=>{if(null!=this.currentOrder){if(this.getPizzasUnd()>this.config_storage["products-per-gap"])return void(this.numProductsOverload=!0);this.orderService.gaps(this.getPizzasUnd()).subscribe(t=>{this.gaps=t},t=>{console.error(t),alert("[ERROR] "+t.message)})}})}getPizzasUnd(){let t=0;return this.order.lines.forEach(i=>{i.pizza&&(t+=i.half?.5:i.und)}),parseInt(t.toString())}removeUnd(t){t.removeUnd(),this.getGaps()}addUnd(t){this.pickupTime="",t.addUnd(),this.getGaps()}removeLine(t){this.pickupTime="",this.currentOrder.removeLine(t),this.getGaps()}goCheckout(){if(!this.canDoOrder())return void this.presentAlert("Ya has alcanzado el n\xfamero m\xe1ximo de pedidos por d\xeda");if(!this.orderReady())return;this.currentOrder.pickupTime=this.pickupTime;try{this.currentOrder.isOk()}catch(i){return void this.presentAlert(String(i))}let t=this.currentOrder.prepareToPost();this.orderInProccess=!0,this.orderService.post(t).subscribe(()=>{this.addOrderPerDay(),this.order.clear(),this.currentOrder.clear(),this.showPopup()},i=>{this.orderInProccess=!1,alert("Ups! "+i.error)})}showPopup(){this.presentSuccessAlert()}canDoOrder(){var t=this;return(0,u.A)(function*(){try{const i=yield t.loadUserOrders();if(null!=i){const s=JSON.parse(i),l=t.config_storage["orders-max"];if(t.isManager)return!0;if(Date.now()-s.date<864e5&&s.num>=l)return!1}return!0}catch(i){return console.error("Error loading user orders:",i),!1}})()}addOrderPerDay(){this.loadUserOrders().then(t=>{let i;null==t?i={num:1,date:Date.now()}:(i=JSON.parse(t),Date.now()-i.date<864e5?i.num+=1:i={num:1,date:Date.now()}),this.saveUserOrders(i)})}orderReady(){return this.isManager?""!=this.currentOrder.name&&""!=this.currentOrder.phone&&""!=this.pickupTime:""!=this.currentOrder.name&&""!=this.currentOrder.phone&&h.A.validatePhone(this.currentOrder.phone)&&""!=this.currentOrder.email&&h.A.validateEmail(this.currentOrder.email)&&""!=this.pickupTime}presentSuccessAlert(){var t=this;return(0,u.A)(function*(){const i=yield t.alertController.create({header:"Pedido enviado",message:`Hora de recogida: ${O(1e3*parseInt(t.pickupTime)).format("HH:mm")}`,buttons:[{text:"OK",handler:()=>{setTimeout(()=>{i.dismiss(),t.router.navigate(["/menu"])},6e4)}}]});yield i.present()})()}editLine(t){t.isHalfAndHalf||this.router.navigate(["/product",t.productId,t])}presentAlert(t){var i=this;return(0,u.A)(function*(){yield(yield i.alertController.create({message:t,buttons:["OK"]})).present()})()}loadConfig(){var t=this;return(0,u.A)(function*(){const{value:i}=yield f.p.get({key:"config"});i&&(t.config_storage=JSON.parse(i),console.log("CONFIG: ",t.config_storage))})()}saveUserOrders(t){return(0,u.A)(function*(){const i=JSON.stringify(t);yield f.p.set({key:"userOrders",value:i})})()}loadUserOrders(){return(0,u.A)(function*(){const{value:t}=yield f.p.get({key:"userOrders"});return t?JSON.parse(t):null})()}}return(n=o).\u0275fac=function(t){return new(t||n)(e.rXU(x.Q),e.rXU(g.Ix),e.rXU(a.hG),e.rXU(I.D),e.rXU(b.OD))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-cart"]],decls:10,vars:3,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],["defaultHref","/menu"],[1,"ion-text-center",2,"font-size","22px"],["class","icontent",4,"ngIf"],[4,"ngIf"],[1,"icontent"],["padding","",4,"ngIf"],[1,"butnsholder"],["size","12",4,"ngIf"],[2,"height","80px"],["class","ion-padding","class","pizzacard",4,"ngFor","ngForOf"],[1,"pizzacard"],["size","4"],["item-start","","padding","",3,"click"],[3,"src","alt",4,"ngIf"],["size","8"],["size","12",1,"ion-no-padding"],[1,"details"],[2,"font-size","1.2rem","color","#e30025"],["size","12",2,"padding-left","0","margin-top","5px"],[2,"display","flex","align-items","center","margin-top","8px"],["size","6",2,"padding-left","0","display","flex","align-items","center"],["ion-button","","icon-only","","class","countbtn","no-margin","","item-left","","clear","","color","lred",3,"click",4,"ngIf"],["class","countbtn unidades","ion-button","","item-left","","color","lred","clear","",4,"ngIf"],["class","countbtn","ion-button","","icon-only","","no-margin","","item-left","","clear","","color","lred",3,"click",4,"ngIf"],["size","6",2,"display","flex","justify-content","flex-end","align-items","center"],["item-right","",1,"price"],["size","12",2,"padding-left","0"],[3,"click"],[1,"trash-container"],["src","assets/imgs/trash.png","alt","Eliminar",1,"ico-trash"],[2,"height","6px"],[3,"src","alt"],[2,"font-weight","bold"],[2,"color","red"],["ion-button","","icon-only","","no-margin","","item-left","","clear","","color","lred",1,"countbtn",3,"click"],["name","remove-circle-outline",1,"icon-custom-cart"],["ion-button","","item-left","","color","lred","clear","",1,"countbtn","unidades"],["name","add-circle-outline",1,"icon-custom-cart"],["padding",""],["lines","none",4,"ngIf"],["placeholder","Nombre",3,"ngModel","ngModelChange"],["type","tel","placeholder","Tel\xe9fono",3,"ngModel","ngModelChange"],["lines","none"],["label","Hora de recogida",3,"ngModel","ngModelChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],[1,"message"],["size","12"],["expand","block",3,"disabled","click"]],template:function(t,i){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title",4),e.EFF(5,"Mi pedido"),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,X,7,3,"div",5),e.k0s(),e.j41(8,"ion-footer"),e.DNE(9,Y,3,4,"div",6),e.k0s()),2&t&&(e.Y8G("translucent",!0),e.R7$(7),e.Y8G("ngIf",null!=i.currentOrder),e.R7$(2),e.Y8G("ngIf",null!=i.currentOrder&&i.currentOrder.total>0))},dependencies:[p.Sq,p.bT,_.BC,_.vS,a.QW,a.b_,a.hU,a.W9,a.M0,a.eU,a.iq,a.$w,a.uz,a.nf,a.AF,a.ln,a.Nm,a.Ip,a.Zx,a.BC,a.ai,a.Je,a.Gw,a.el,p.QX],styles:[".bar-button-menutoggle-md[_ngcontent-%COMP%]{display:block!important}.loginbtn[_ngcontent-%COMP%]{border-radius:25px;color:#fff!important;font-size:1.5em;height:50px;background-color:#e30025}ion-card[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{padding:0!important;height:80px;background-color:#f9f9f9!important;overflow:hidden;width:105px}ion-card[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:105px;min-width:100%;max-width:inherit}.countbtn[_ngcontent-%COMP%]{height:30px;width:30px;background-color:#fff;color:#e30025;font-size:2em;margin-top:-10px}.countbtn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{height:30px;width:30px}.countbtn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.unidades[_ngcontent-%COMP%]{margin-top:-10px}.price[_ngcontent-%COMP%]{color:#e30025;font-size:25px;font-weight:700;font-family:Serif}.long-text[_ngcontent-%COMP%]{color:#d3d3d3}.details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0;margin-top:5px}.trash-container[_ngcontent-%COMP%]{display:flex}.trash-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-right:0}.ico-trash[_ngcontent-%COMP%]{height:30px;width:auto;margin-right:5px}ion-footer[_ngcontent-%COMP%]{background-color:#e30025;color:#fff}ion-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;font-size:30px;font-weight:700;font-family:Serif;padding:8px;text-align:center}.message[_ngcontent-%COMP%]{background-color:#e30025;border-radius:10px;color:#fff;padding:10px;font-weight:700;font-size:1.2em;text-align:center;white-space:normal}.butnsholder[_ngcontent-%COMP%]{margin-top:20px}.butnsholder[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;border-radius:25px;color:#fff!important;font-size:1.6em;height:50px;background-color:#e30025;width:90%;margin-left:5%;margin-right:5%}"]}),o})();const V=[{path:"cart",component:v}];let B=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.iI.forChild(V),g.iI]}),o})();const H=[{path:"",component:v}];let L=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.MD,_.YN,a.bv,B,g.iI.forChild(H)]}),o})()}}]);