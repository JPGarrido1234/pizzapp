"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7046],{7046:(x,h,s)=>{s.r(h),s.d(h,{UserPageModule:()=>F});var f=s(177),p=s(4341),i=s(8974),g=s(1007),d=s(467),M=s(2081),e=s(6276),C=s(4666);function y(o,l){if(1&o){const a=e.RV6();e.j41(0,"div",11)(1,"ion-row")(2,"ion-col",7)(3,"ion-item",12)(4,"ion-input",13),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.name=r)}),e.k0s()()(),e.j41(5,"ion-col",7)(6,"ion-item",12)(7,"ion-input",14),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.login=r)}),e.k0s()()(),e.j41(8,"ion-col",7)(9,"ion-item",12)(10,"ion-input",15),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.address=r)}),e.k0s()()(),e.j41(11,"ion-col",7)(12,"ion-item",12)(13,"ion-input",16),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.zip=r)}),e.k0s()()(),e.j41(14,"ion-col",7)(15,"ion-item",12)(16,"ion-input",17),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.birthDate=r)}),e.k0s()()()(),e.j41(17,"div",18),e.EFF(18," Completa los siguientes campos si quieres cambiar tu contrase\xf1a "),e.k0s(),e.j41(19,"ion-row")(20,"ion-col",7)(21,"ion-item",12)(22,"ion-input",19),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.password=r)}),e.k0s()()(),e.j41(23,"ion-col",7)(24,"ion-item",12)(25,"ion-input",20),e.bIt("ngModelChange",function(r){e.eBV(a);const n=e.XpG();return e.Njj(n.userForm.repeated=r)}),e.k0s()()()()()}if(2&o){const a=e.XpG();e.R7$(4),e.Y8G("ngModel",a.userForm.name),e.R7$(3),e.Y8G("ngModel",a.userForm.login),e.R7$(3),e.Y8G("ngModel",a.userForm.address),e.R7$(3),e.Y8G("ngModel",a.userForm.zip),e.R7$(3),e.Y8G("ngModel",a.userForm.birthDate),e.R7$(6),e.Y8G("ngModel",a.userForm.password),e.R7$(3),e.Y8G("ngModel",a.userForm.repeated)}}let _=(()=>{var o;class l{constructor(t,r,n){this.userService=t,this.alertController=r,this.router=n}ionViewDidLoad(){}ionViewDidEnter(){var t=this;return(0,d.A)(function*(){if(yield t.userService.isLogged())if(yield t.userService.isWaitingForCode())t.router.navigate(["/code"]);else{if(t.myUser=yield t.userService.getUser(),!t.myUser)throw new Error("User is null");t.userForm={id:t.myUser.id,name:t.myUser.name,login:t.myUser.login,address:t.myUser.address,zip:t.myUser.zip,birthDate:t.myUser.birthDate?t.myUser.birthDate:"",password:"",repeated:""}}else t.router.navigate(["/register"])})()}checkUserData(){var t=this;return(0,d.A)(function*(){let r="";if(""===t.userForm.login&&(r="El email es requerido"),""===t.userForm.name&&(r="El nombre es requerido"),""!=t.userForm.password)try{M.A.checkPassword(t.userForm.password,t.userForm.repeated)}catch(n){r=n}if(""===r)return!0;yield(yield t.alertController.create({header:"Error",message:r,buttons:["OK"]})).present()})()}updateUser(){var t=this;if(!this.checkUserData())return;const n=this.formatDate(this.userForm.birthDate);this.userForm.birthDate=n,this.userService.updateUser(this.userForm).then(function(){var u=(0,d.A)(function*(c){yield(yield t.alertController.create({header:"Datos actualizados",message:"Tus datos de usuario han sido actualizados",buttons:["OK"]})).present(),t.myUser.name=t.userForm.name,t.myUser.login=t.userForm.login,t.myUser.address=t.userForm.address,t.myUser.zip=t.userForm.zip,""!=t.userForm.birthDate&&(t.myUser.birthDate=t.userForm.birthDate),t.myUser.logged=!0,t.userService.storeUserData(t.myUser),t.userForm.password="",t.userForm.repeated=""});return function(c){return u.apply(this,arguments)}}(),function(){var u=(0,d.A)(function*(c){yield(yield t.alertController.create({header:"Error",message:"Ha ocurrido un error al actualizar tus datos, int\xe9ntalo de nuevo m\xe1s tarde",buttons:["OK"]})).present()});return function(c){return u.apply(this,arguments)}}())}parseDate(t){const r=t.split("-");if(3===r.length){const n=parseInt(r[0],10),u=parseInt(r[1],10)-1,c=parseInt(r[2],10),m=new Date(c,u,n);if(!isNaN(m.getTime()))return m}return null}formatDate(t){const r=this.parseDate(t);if(r){const n=r.getDate().toString().padStart(2,"0"),u=(r.getMonth()+1).toString().padStart(2,"0");return`${r.getFullYear()}-${u}-${n}`}return""}removeUser(){var t=this;return(0,d.A)(function*(){yield(yield t.alertController.create({header:"ATENCI\xd3N",message:"Vas a solicitar eliminar tu cuenta de nuestro sistema, por lo que se eliminar\xe1 todo el historial de pedidos y tus datos de usuario. \xbfEst\xe1s seguro?",buttons:[{text:"Ok, adelante",handler:()=>{t.doRemove()}},{text:"Cancelar"}]})).present()})()}doRemove(){var t=this;this.userService.removeUser(this.myUser.id).subscribe(function(){var r=(0,d.A)(function*(n){yield(yield t.alertController.create({header:"Solicitud enviada",message:"La solicitud para eliminar tu cuenta de nuestro sistema ha sido recibida correctamente. En breve ser\xe1 eliminada de nuestra base de datos.",buttons:["OK"]})).present(),t.userService.removeUserData(),t.router.navigate(["/menu"])});return function(n){return r.apply(this,arguments)}}(),function(){var r=(0,d.A)(function*(n){yield(yield t.alertController.create({header:"Error",message:"Ha ocurrido un error al eliminar tu cuenta, Int\xe9ntalo de nuevo m\xe1s tarde",buttons:["OK"]})).present()});return function(n){return r.apply(this,arguments)}}())}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(C.D),e.rXU(i.hG),e.rXU(g.Ix))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-user"]],decls:19,vars:2,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],["defaultHref","/menu"],[1,"ion-text-center",2,"font-size","22px"],["padding-vertical","",1,"icontent"],["class","detailsholder","padding","","text-center","",4,"ngIf"],["size","12"],["color","light","size","large","expand","block","shape","round",3,"click"],[2,"color","#E30025","font-weight","bold","font-size","22px"],["color","medium","size","large","expand","block","shape","round",3,"click"],["padding","","text-center","",1,"detailsholder"],[1,"ion-text-center","padding"],["placeholder","Nombre","type","text",1,"custom",3,"ngModel","ngModelChange"],["placeholder","Email","type","text",3,"ngModel","ngModelChange"],["placeholder","Direcci\xf3n","type","text",3,"ngModel","ngModelChange"],["placeholder","C\xf3digo postal","type","text",3,"ngModel","ngModelChange"],["type","text","placeholder","Fecha de nacimiento",3,"ngModel","ngModelChange"],[1,"text"],["placeholder","Contrase\xf1a","type","password",3,"ngModel","ngModelChange"],["placeholder","Repetir contrase\xf1a","type","password",3,"ngModel","ngModelChange"]],template:function(t,r){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title",4),e.EFF(5,"Tus datos personales"),e.k0s()()(),e.j41(6,"ion-content")(7,"div",5),e.DNE(8,y,26,7,"div",6),e.j41(9,"ion-row")(10,"ion-col",7)(11,"ion-button",8),e.bIt("click",function(){return r.updateUser()}),e.j41(12,"span",9),e.EFF(13,"CAMBIAR DATOS"),e.k0s()()()(),e.j41(14,"ion-row")(15,"ion-col",7)(16,"ion-button",10),e.bIt("click",function(){return r.removeUser()}),e.j41(17,"span",9),e.EFF(18,"ELIMINAR CUENTA"),e.k0s()()()()()()),2&t&&(e.Y8G("translucent",!0),e.R7$(8),e.Y8G("ngIf",r.userForm))},dependencies:[f.bT,p.BC,p.vS,i.Jm,i.QW,i.hU,i.W9,i.eU,i.$w,i.uz,i.ln,i.BC,i.ai,i.Gw,i.el],styles:["ion-content[_ngcontent-%COMP%]{--background: #E30025}.icontent[_ngcontent-%COMP%]{padding:15px}.title[_ngcontent-%COMP%]{text-align:center;color:#fff}.text[_ngcontent-%COMP%]{color:#fff;width:90%;margin:auto;font-size:1em}label[_ngcontent-%COMP%]{color:#fff;margin-bottom:4px;font-size:1.2em}.logoholder[_ngcontent-%COMP%]{text-align:center;margin-left:auto;margin-right:auto}.logoholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#a5a5a5!important}ion-item[_ngcontent-%COMP%]{border-radius:35px!important;box-shadow:0 0 30px #0000001a}ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#e30025!important}ion-input[_ngcontent-%COMP%]{background-color:#fff;width:90vw;margin:10px;padding-top:10px;padding-bottom:10px}ion-input.custom[_ngcontent-%COMP%]{font-size:22px;font-weight:700;--placeholder-color: #000;--placeholder-opacity: .4}.loginbtn[_ngcontent-%COMP%]{border-radius:25px;color:#fff!important;font-size:1.5em;height:30px;background-color:#cc0020}.registerbtn[_ngcontent-%COMP%]{border-radius:25px;color:#cc0020!important;font-size:1.5em;height:50px;margin-top:10px}.registerbtn-dark[_ngcontent-%COMP%]{background-color:#ccc}.link[_ngcontent-%COMP%]{text-decoration:underline}"]}),l})();const U=[{path:"user",component:_}];let v=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.iI.forChild(U),g.iI]}),l})();const b=[{path:"",component:_}];let F=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[f.MD,p.YN,i.bv,v,g.iI.forChild(b)]}),l})()}}]);