"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6694],{6694:(I,z,s)=>{s.r(z),s.d(z,{HalfPizzaPageModule:()=>x});var h=s(177),P=s(4341),r=s(8974),o=s(1007),u=s(467),C=s(2181),g=s(7628),f=s(8254),t=s(6276),d=s(6915),m=s(2056);function E(n,c){if(1&n){const a=t.RV6();t.j41(0,"div",9),t.bIt("click",function(){t.eBV(a);const i=t.XpG();return t.Njj(i.goCart())}),t.j41(1,"div"),t.EFF(2),t.k0s()()}if(2&n){const a=t.XpG();t.R7$(2),t.JRh(a.unds)}}function T(n,c){if(1&n){const a=t.RV6();t.j41(0,"ion-row")(1,"ion-col",12)(2,"img",13),t.bIt("click",function(){t.eBV(a);const i=t.XpG().$implicit,l=t.XpG();return t.Njj(l.setHalf(i))}),t.k0s()(),t.j41(3,"ion-col",14)(4,"ion-item",15),t.bIt("click",function(){t.eBV(a);const i=t.XpG().$implicit,l=t.XpG();return t.Njj(l.setHalf(i))}),t.j41(5,"ion-label",16)(6,"h2"),t.EFF(7),t.k0s(),t.j41(8,"p",17),t.EFF(9),t.k0s(),t.j41(10,"div",18),t.EFF(11),t.nI1(12,"number"),t.k0s()()()()()}if(2&n){const a=t.XpG().$implicit;t.R7$(2),t.Y8G("src",a.image,t.B4B)("alt",a.name),t.R7$(5),t.JRh(a.name),t.R7$(2),t.JRh(a.description),t.R7$(2),t.SpI(" ",t.i5U(12,5,a.price,"1.2-2")," \u20ac ")}}function R(n,c){if(1&n&&(t.j41(0,"ion-card",10),t.DNE(1,T,13,8,"ion-row",11),t.k0s()),2&n){const a=c.$implicit,e=t.XpG();t.R7$(1),t.Y8G("ngIf",a.id!=e.halfPizzaId)}}let y=(()=>{var n;class c{constructor(e,i,l,p){this.orderService=e,this.productService=i,this.route=l,this.router=p,this.products=[],this.categoryId="",this.halfPizzaId="",this.pizzaSize="",this.isPizzaCategory=!0,this.unds=null,this.order=null,this.categories_storage=[],this.ingredients_storage=[],this.sizes_storage=[]}ngOnInit(){this.loadCategories().then(()=>{this.loadIngredients().then(()=>{this.loadSizes().then(()=>{this.route.paramMap.subscribe(e=>{this.halfPizzaId=e.get("halfPizzaId")||"",this.pizzaSize=e.get("pizzaSize")||"",this.categoryId=e.get("categoryId")||"",console.log("Category ID: "+this.categoryId),this.setCategoryPizzaId(),this.getProducts(),this.getCurrentOrder().then(i=>{this.order=i,this.unds=this.order.unds,console.log("CURRENT ORDER: ",this.order),this.goCart()})})})})})}ionViewDidLoad(){this.route.paramMap.subscribe(e=>{this.halfPizzaId=e.get("halfPizzaId")||"",this.pizzaSize=e.get("pizzaSize")||"",this.categoryId=e.get("categoryId")||"",this.setCategoryPizzaId(),this.getProducts(),this.getCurrentOrder().then(i=>{this.order=i,this.unds=this.order.unds,this.goCart()})})}setCategoryPizzaId(){this.category=this.categories_storage.find(e=>e.name.toLowerCase().includes("pizzas")),this.categoryId=this.category.id,this.isPizzaCategory=this.category.name.toLowerCase().includes("pizzas")}getProducts(){this.productService.findAll(this.categoryId).then(e=>{e.forEach(i=>{if(console.log("Item:",i),"CUSTOMIZABLE_TOTAL"===i.type)return;let l=new C.Y(i,this.productService,this.ingredients_storage);this.category.name.toLowerCase().includes("pizzas")&&l.sizes.filter(_=>_.code==this.pizzaSize),this.products.push(l)})},e=>{console.error(e)})}setHalf(e){try{let i=this.products.find(v=>v.id==this.halfPizzaId);const l=i.sizes.find(v=>v.code===this.pizzaSize),p=e.sizes.find(v=>v.code===this.pizzaSize);let _=l.price;p&&p.price>_&&(_=p.price);const M="1/2 "+i.name+" + 1/2 "+e.name,w=new C.Y({id:"half",name:M,description:M,category:this.category.id,price:_,pizza:!0,available:!0,order:1,allergens:[],sizes:[],ingredients:[],active:!0,ingredientsNotAvailable:[],image:"",type:""},this.productService,this.ingredients_storage);let O=new g.$(this.order,w,this.category,this.ingredients_storage,this.sizes_storage);O.setHalfAndHalf(!0),O.setImage("assets/imgs/half-pizza.png"),O.setSizeText(this.pizzaSize),this.getCurrentOrder().then(()=>{this.unds=this.order.unds,this.order.addLine(O),console.log("CURRENT ORDER: ",this.order),this.goCart()})}catch(i){console.error(i),alert("Ha habido un problema interno, por favor int\xe9ntelo de nuevo m\xe1s tarde o seleccione otra pizza")}}getCurrentOrder(){return this.orderService.getOrder().then(e=>{this.order=e})}goCart(){this.router.navigate(["/cart"])}loadCategories(){var e=this;return(0,u.A)(function*(){const{value:i}=yield f.p.get({key:"categories"});i&&(e.categories_storage=JSON.parse(i))})()}loadIngredients(){var e=this;return(0,u.A)(function*(){const{value:i}=yield f.p.get({key:"ingredients"});i&&(e.ingredients_storage=JSON.parse(i))})()}loadSizes(){var e=this;return(0,u.A)(function*(){const{value:i}=yield f.p.get({key:"sizes"});i&&(e.sizes_storage=JSON.parse(i))})()}}return(n=c).\u0275fac=function(e){return new(e||n)(t.rXU(d.Q),t.rXU(m.b),t.rXU(o.nX),t.rXU(o.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-halfpizza"]],decls:11,vars:4,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],["defaultHref","/menu"],["slot","end"],["class","ico-und",3,"click",4,"ngIf"],[3,"fullscreen"],[1,"icontent"],["class","pizzacard animated",4,"ngFor","ngForOf"],[1,"ico-und",3,"click"],[1,"pizzacard","animated"],[4,"ngIf"],["size","4"],[3,"src","alt","click"],["size","8"],["lines","none",1,"details",3,"click"],[2,"margin-top","0"],["text-wrap",""],[1,"price"]],template:function(e,i){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t.nrm(3,"ion-back-button",3)(4,"ion-menu-button"),t.k0s(),t.j41(5,"ion-buttons",4),t.DNE(6,E,3,1,"div",5),t.k0s()()(),t.j41(7,"ion-content",6)(8,"div",7)(9,"ion-list"),t.DNE(10,R,2,1,"ion-card",8),t.k0s()()()),2&e&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("ngIf",i.unds>0),t.R7$(1),t.Y8G("fullscreen",!0),t.R7$(3),t.Y8G("ngForOf",i.products))},dependencies:[h.Sq,h.bT,r.QW,r.b_,r.hU,r.W9,r.eU,r.uz,r.he,r.nf,r.MC,r.ln,r.ai,r.el,h.QX],styles:[".bar-button-menutoggle-md[_ngcontent-%COMP%]{display:block!important}.ico-und[_ngcontent-%COMP%]{position:fixed;z-index:9;width:40px;height:40px;background-color:#fff;border:2px solid #fff;border-radius:50%;right:20px;top:25px}.ico-und[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:18px;font-weight:700;color:#e30025;margin-top:6px}ion-card[_ngcontent-%COMP%]{margin-right:0}ion-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#e30025!important}ion-card[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{padding:0!important;height:80px;background-color:#f9f9f9!important;overflow:hidden}ion-card[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;min-width:100%;max-width:inherit}ion-card[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#e30025;font-size:26px;font-weight:700;font-family:Serif;width:100%}ion-item[_ngcontent-%COMP%]{padding-left:0!important}.butnsholder[_ngcontent-%COMP%]{margin-top:20px}.butnsholder[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;border-radius:25px;color:#fff!important;font-size:1em;height:30px;background-color:#e30025}"]}),c})();const S=[{path:"halfpizza",component:y}];let H=(()=>{var n;class c{}return(n=c).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[o.iI.forChild(S),o.iI]}),c})();const b=[{path:"",component:y}];let x=(()=>{var n;class c{}return(n=c).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[h.MD,P.YN,r.bv,H,o.iI.forChild(b)]}),c})()},450:(I,z,s)=>{s.d(z,{p:()=>h});class h{constructor(){this.name="",this.number="",this.phone="",this.email="",this.pickupTime="",this.orderStatus="WAITING",this.total=0,this.notes="",this.unds=0,this.lines=[],this.userId="",this.date=""}removeLine(r){let o=[];this.lines.forEach(u=>{u.id!=r.id&&o.push(u)}),this.lines=o,this.calculateTotal()}addLine(r){this.lines.push(r),this.calculateTotal()}calculateTotal(){this.unds=0,this.total=0,this.lines.forEach(r=>{this.total+=r.priceTotal,this.unds+=r.und})}isOk(){if(0==this.total||this.lines.length<1)throw"Pedido sin productos";let r=0;if(this.lines.forEach(o=>{o.half&&r++}),r%2>0)throw"Tienes que pedir otra media pizza para completar el pedido";if(""==this.name)throw"Tienes que indicar un nombre de pedido";if(""==this.phone)throw"Tienes que indicarnos tu n\xfamero de tel\xe9fono";if(""==this.email)throw"Tienes que indicarnos tu email";if(""==this.pickupTime)throw"Tienes que especificar la hora de recogida del pedido"}clear(){this.pickupTime="",this.total=0,this.unds=0,this.notes="",this.lines=[]}prepareToPost(){this.lines.forEach(o=>{delete o.order,delete o.image,delete o.ingredients,delete o.product});let r=JSON.parse(JSON.stringify(this));return r.lines.forEach(o=>{delete o.id,delete o.image,delete o.category,delete o.product,delete o.sizes,delete o.ingredients}),r}getPizzasUnd(){let r=0;return this.lines.forEach(o=>{o.pizza&&(r+=o.half?.5:o.und)}),parseInt(r.toString())}}},6915:(I,z,s)=>{s.d(z,{Q:()=>C});var h=s(5312),P=s(2081),r=s(450),o=s(6276),u=s(1626);let C=(()=>{var g;class f{constructor(d){this.http=d,this.order=null}post(d){return this.http.post(h.c.API_URL+"/orders",d,P.A.getHeaders())}gaps(d){return this.http.get(h.c.API_URL+"/gaps/"+d+"?ngsw-bypass=true",P.A.getHeaders())}setOrder(d){this.order=d}getOrder(){return new Promise((d,m)=>{null!==this.order||(this.order=new r.p),d(this.order)})}}return(g=f).\u0275fac=function(d){return new(d||g)(o.KVO(u.Qq))},g.\u0275prov=o.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),f})()}}]);