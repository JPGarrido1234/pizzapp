"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7777],{7777:(S,v,d)=>{d.r(v),d.d(v,{MenuPageModule:()=>L});var g=d(177),m=d(4341),n=d(8974),s=d(1007),l=d(467);class P{constructor(c,o,e,r){this.id=c,this.name=o,this.type=e,this.order=r}isPizzaCategory(){return this.name.toLowerCase().includes("pizzas")}}class f{constructor(c,o,e,r,a,h){this.id=c,this.name=o,this.active=e,this.available=r,this.price=a,this.base=h}}class y{constructor(c,o,e){this.code=c,this.name=o,this.multiplier=e}}var p=d(8254),u=d(450),t=d(6276),M=d(4666),O=d(5312),C=d(2081),_=d(1626);let U=(()=>{var i;class c{constructor(e){this.http=e}findAll(){var e=this;return(0,l.A)(function*(){return e.http.get(O.c.API_URL+"/categories",C.A.getHeaders())})()}}return(i=c).\u0275fac=function(e){return new(e||i)(t.KVO(_.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),c})(),x=(()=>{var i;class c{constructor(e){this.http=e}findAll(){return this.http.get(O.c.API_URL+"/ingredients",C.A.getHeaders())}}return(i=c).\u0275fac=function(e){return new(e||i)(t.KVO(_.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),c})(),A=(()=>{var i;class c{constructor(e){this.http=e}findAll(){return this.http.get(O.c.API_URL+"/config",C.A.getHeaders())}isOpen(){var e=this;return(0,l.A)(function*(){return e.http.get(O.c.API_URL+"/isopen",C.A.getHeaders())})()}}return(i=c).\u0275fac=function(e){return new(e||i)(t.KVO(_.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),c})();var E=d(2056),b=d(6915);function T(i,c){if(1&i){const o=t.RV6();t.j41(0,"div",10),t.bIt("click",function(){t.eBV(o);const r=t.XpG();return t.Njj(r.goCart())}),t.j41(1,"div"),t.EFF(2),t.k0s()()}if(2&i){const o=t.XpG();t.R7$(2),t.JRh(o.unds)}}function z(i,c){if(1&i){const o=t.RV6();t.j41(0,"ion-card",12),t.bIt("click",function(){const a=t.eBV(o).$implicit,h=t.XpG(2);return t.Njj(h.goCategory(a.id,a.name))}),t.j41(1,"ion-item")(2,"div",13)(3,"h1"),t.EFF(4),t.k0s()()()()}if(2&i){const o=c.$implicit;t.R7$(4),t.JRh(o.name)}}function D(i,c){if(1&i&&(t.j41(0,"ion-list"),t.DNE(1,z,5,1,"ion-card",11),t.k0s()),2&i){const o=t.XpG();t.R7$(1),t.Y8G("ngForOf",o.categories)}}let I=(()=>{var i;class c{constructor(e,r,a,h,j,N,F,G){this.router=e,this.userService=r,this.categoryService=a,this.ingredientService=h,this.configService=j,this.productService=N,this.alertController=F,this.orderService=G,this.categories=[],this.holidays=[],this.unds=0,this.user=null,this.categories_storage=[],this.ingredients_storage=[],this.sizes_storage=[]}ngOnInit(){var e=this;try{this.loadUserOrders().then(r=>{this.orderService.getOrder().then(a=>{console.log("Order_menu: "+r),this.order=a,this.refreshCartUnds(),this.getCategories()})})}catch(r){console.error("Error in ngOnInit Order:",r)}try{this.userService.getUser().then(function(){var r=(0,l.A)(function*(a){e.user=a,console.log("User_menu: "+JSON.stringify(e.user)),e.user&&!(yield e.userService.isLogged())&&e.alertController.create({header:"ATENCI\xd3N",message:"Por favor, accede cuanto antes a editar tus datos personales y cambia tu contrase\xf1a. Gracias.",buttons:[{text:"Ok, m\xe1s tarde lo hago"},{text:"Venga, ll\xe9vame a cambiarla",handler:()=>{e.router.navigate(["/user"])}}]}).then(h=>h.present())});return function(a){return r.apply(this,arguments)}}())}catch(r){console.error("Error in ngOnInit:",r),this.router.navigate(["/register"])}}ionViewDidLoad(){var e=this;try{this.loadUserOrders().then(r=>{this.orderService.getOrder().then(a=>{console.log("Order_menu: "+r),this.order=a,null==this.order&&(this.order=new u.p),this.refreshCartUnds()})})}catch(r){console.error("Error in ionViewDidLoad:",r)}this.getCategories(),this.userService.getUser().then(function(){var r=(0,l.A)(function*(a){e.user=a,console.log("User_menu: "+JSON.stringify(e.user)),e.user&&!e.user.isLogged()&&e.alertController.create({header:"ATENCI\xd3N",message:"Por favor, accede cuanto antes a editar tus datos personales y cambia tu contrase\xf1a. Gracias.",buttons:[{text:"Ok, m\xe1s tarde lo hago"},{text:"Venga, ll\xe9vame a cambiarla",handler:()=>{e.router.navigate(["/user"])}}]}).then(h=>h.present())});return function(a){return r.apply(this,arguments)}}())}ionViewDidEnter(){try{this.orderService.getOrder().then(e=>{this.order=e,this.getIngredients(),this.getConfig(),this.getSizes(),this.checkIfIsOpen(),this.refreshCartUnds()})}catch(e){console.error("Error in ionViewDidLoad:",e)}}refreshCartUnds(){null!=this.order&&null!=this.order.unds&&(this.unds=this.order.unds?this.order.unds:0),console.log("unds: "+this.unds)}getCategories(){var e=this;return(0,l.A)(function*(){(yield e.categoryService.findAll()).subscribe(r=>{e.categories=[],r.forEach(a=>{let h=new P(a.id,a.name,a.type,a.order);e.categories.push(h)}),e.saveCategories(e.categories)},r=>{console.error(r)})})()}getIngredients(){this.ingredientService.findAll().subscribe(e=>{e.forEach(r=>{let a=new f(r.id,r.name,r.active,r.available,r.price,r.base);this.ingredients_storage.push(a)}),this.saveIngredients(this.ingredients_storage)},e=>{console.error(e)})}getConfig(){this.configService.findAll().subscribe(e=>{this.saveConfig(e)},e=>{console.error(e)})}checkIfIsOpen(){this.configService.isOpen().then(e=>{if(this.holidays=e,this.holidays.length>0){let r=localStorage.getItem("holidaysPopUp");(null==r||Date.now()-parseInt(r)>1e4)&&(this.showHoliDaysPopUp(this.holidays[0].dateTo,this.holidays[0].description),localStorage.setItem("holidaysPopUp",Date.now().toString()))}else localStorage.removeItem("holidaysPopUp")},e=>{console.error(e)})}showHoliDaysPopUp(e,r){var a=this;return(0,l.A)(function*(){yield(yield a.alertController.create({header:"Holiday Details",subHeader:`Opening Date: ${e}`,message:r,buttons:["OK"]})).present()})()}getSizes(){this.productService.getSizes().subscribe(e=>{e.forEach(r=>{let a=new y(r.code,r.name,r.multiplier);this.sizes_storage.push(a)}),this.saveSizes(this.sizes_storage)},e=>{console.error(e)})}goCategory(e,r){this.router.navigate(["/category",e,r])}goCart(){this.router.navigate(["/cart"])}openMenu(){}saveCategories(e){return(0,l.A)(function*(){const r=JSON.stringify(e);yield p.p.set({key:"categories",value:r})})()}saveIngredients(e){return(0,l.A)(function*(){const r=JSON.stringify(e);yield p.p.set({key:"ingredients",value:r})})()}saveSizes(e){return(0,l.A)(function*(){const r=JSON.stringify(e);yield p.p.set({key:"sizes",value:r})})()}saveConfig(e){return(0,l.A)(function*(){const r=JSON.stringify(e);yield p.p.set({key:"config",value:r})})()}loadUserOrders(){return(0,l.A)(function*(){const{value:e}=yield p.p.get({key:"userOrders"});return e?JSON.parse(e):null})()}}return(i=c).sCategories=[],i.sIngredients=[],i.sConfig={},i.sSizes=[],i.isOpen=!0,i.\u0275fac=function(e){return new(e||i)(t.rXU(s.Ix),t.rXU(M.D),t.rXU(U),t.rXU(x),t.rXU(A),t.rXU(E.b),t.rXU(n.hG),t.rXU(b.Q))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-menu"]],decls:12,vars:4,consts:[[3,"translucent"],[1,"red-toolbar"],["slot","start"],["slot","end"],["class","ico-und",3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","cart-outline",1,"icon-custom"],[1,"ion-text-center"],[3,"fullscreen"],[4,"ngIf"],[1,"ico-und",3,"click"],["class","cardleft animated bounceInLeft",3,"click",4,"ngFor","ngForOf"],[1,"cardleft","animated","bounceInLeft",3,"click"],[1,"details"]],template:function(e,r){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-buttons",3),t.DNE(5,T,3,1,"div",4),t.j41(6,"ion-button",5),t.bIt("click",function(){return r.goCart()}),t.nrm(7,"ion-icon",6),t.k0s()(),t.j41(8,"ion-title",7),t.EFF(9,"MEN\xda"),t.k0s()()(),t.j41(10,"ion-content",8),t.DNE(11,D,2,1,"ion-list",9),t.k0s()),2&e&&(t.Y8G("translucent",!0),t.R7$(5),t.Y8G("ngIf",r.unds>0),t.R7$(5),t.Y8G("fullscreen",!0),t.R7$(1),t.Y8G("ngIf",r.categories))},dependencies:[g.Sq,g.bT,n.Jm,n.QW,n.b_,n.W9,n.eU,n.iq,n.uz,n.nf,n.MC,n.BC,n.ai],styles:[".ico-und[_ngcontent-%COMP%]{position:fixed;z-index:9;width:40px;height:40px;background-color:#fff;border:2px solid #fff;border-radius:50%;right:20px;top:25px}.ico-und[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:18px;font-weight:700;color:#e30025;margin-top:6px}.icontent[_ngcontent-%COMP%]{margin-top:10vh}.cardleft[_ngcontent-%COMP%]{margin-left:0!important;border-top-right-radius:25px;border-bottom-right-radius:25px;margin-bottom:20px!important;box-shadow:0 0 30px #0000001a}.cardleft[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#e30025!important;font-size:2.2em}.details[_ngcontent-%COMP%]{margin-left:20vw}.ico-und[_ngcontent-%COMP%]{position:fixed;z-index:9;width:30px;height:30px;background-color:#fff;border:2px solid #fff;border-radius:50%;right:25px;top:6px}.ico-und[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:18px;font-weight:700;color:#e30025;margin-top:2px}"]}),c})();const R=[{path:"menu",component:I}];let k=(()=>{var i;class c{}return(i=c).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[s.iI.forChild(R),s.iI]}),c})();const w=[{path:"",component:I}];let L=(()=>{var i;class c{}return(i=c).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[g.MD,m.YN,n.bv,k,s.iI.forChild(w),_.q1]}),c})()},450:(S,v,d)=>{d.d(v,{p:()=>g});class g{constructor(){this.name="",this.number="",this.phone="",this.email="",this.pickupTime="",this.orderStatus="WAITING",this.total=0,this.notes="",this.unds=0,this.lines=[],this.userId="",this.date=""}removeLine(n){let s=[];this.lines.forEach(l=>{l.id!=n.id&&s.push(l)}),this.lines=s,this.calculateTotal()}addLine(n){this.lines.push(n),this.calculateTotal()}calculateTotal(){this.unds=0,this.total=0,this.lines.forEach(n=>{this.total+=n.priceTotal,this.unds+=n.und})}isOk(){if(0==this.total||this.lines.length<1)throw"Pedido sin productos";let n=0;if(this.lines.forEach(s=>{s.half&&n++}),n%2>0)throw"Tienes que pedir otra media pizza para completar el pedido";if(""==this.name)throw"Tienes que indicar un nombre de pedido";if(""==this.phone)throw"Tienes que indicarnos tu n\xfamero de tel\xe9fono";if(""==this.email)throw"Tienes que indicarnos tu email";if(""==this.pickupTime)throw"Tienes que especificar la hora de recogida del pedido"}clear(){this.pickupTime="",this.total=0,this.unds=0,this.notes="",this.lines=[]}prepareToPost(){this.lines.forEach(s=>{delete s.order,delete s.image,delete s.ingredients,delete s.product});let n=JSON.parse(JSON.stringify(this));return n.lines.forEach(s=>{delete s.id,delete s.image,delete s.category,delete s.product,delete s.sizes,delete s.ingredients}),n}getPizzasUnd(){let n=0;return this.lines.forEach(s=>{s.pizza&&(n+=s.half?.5:s.und)}),parseInt(n.toString())}}},6915:(S,v,d)=>{d.d(v,{Q:()=>P});var g=d(5312),m=d(2081),n=d(450),s=d(6276),l=d(1626);let P=(()=>{var f;class y{constructor(u){this.http=u,this.order=null}post(u){return this.http.post(g.c.API_URL+"/orders",u,m.A.getHeaders())}gaps(u){return this.http.get(g.c.API_URL+"/gaps/"+u+"?ngsw-bypass=true",m.A.getHeaders())}setOrder(u){this.order=u}getOrder(){return new Promise((u,t)=>{null!==this.order||(this.order=new n.p),u(this.order)})}}return(f=y).\u0275fac=function(u){return new(u||f)(s.KVO(l.Qq))},f.\u0275prov=s.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),y})()}}]);